<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>×–××Ÿ ×–×”×‘ - ×œ×•"×– ×—×•×¤×©×”</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #ff8c42;
            --secondary: #fff0e6;
            --holiday-bg: #ffe4c4; /* ×¨×§×¢ ×—×•×¤×©×” ×›××• ×‘×“×£ ×™×¦×™×¨×” */
            --bg-event-general: #ffffff;
            --bg-event-lodging: #e6f7ff;
            --bg-event-flight: #cce0ff;
            --bg-event-activity: #fff9e6;
            --text-dark: #5a4f45;
            --text-light: #ffffff;
            --day-block-bg: #ffffff;
            --day-block-shadow: rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Rubik', sans-serif;
            background: var(--holiday-bg);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            padding-top: 20px; /* ×¨×™×•×•×— ×¢×œ×™×•×Ÿ */
            padding-bottom: 20px; /* ×¨×™×•×•×— ×ª×—×ª×•×Ÿ */
        }
        .navbar-brand-live {
            font-size: 1.8rem; /* ×’×•×“×œ ××•×ª×× */
            font-weight: 700;
            color: var(--primary) !important;
            text-decoration: none;
            display: block; /* ×›×“×™ ×©×”-text-align ×™×¤×¢×œ */
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .schedule-title {
            color: var(--text-dark);
            font-weight: 700;
            font-size: 1.8em; /* ×’×•×“×œ ×›×•×ª×¨×ª ×œ×•×– */
        }
        .container {
            background-color: rgba(255, 255, 255, 0.8); /* ×¨×§×¢ ××¢×˜ ×©×§×•×£ ×œ×§×•× ×˜×™×™× ×¨ */
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* --- ×¡×’× ×•× ×•×ª ×©×”×•×¢×ª×§×• ××“×£ ×—×•×¤×©×”.html --- */
        .day-block {
            background: var(--day-block-bg);
            color: var(--text-dark);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--day-block-shadow);
            transition: background .3s;
        }
        .day-block:hover { background: #fefefe; }
        .day-block[data-date] { position: relative; }
        .day-header {
            display: flex; flex-wrap: wrap;
            justify-content: center; align-items: center;
            gap: .5rem; font-size: 1.3rem; font-weight: 500;
            letter-spacing: .5px; margin-bottom: 1.5rem;
            color: var(--primary);
        }
        .lodging-badge { /* ×™×•×¦×’ ×× ×”××™×“×¢ ×§×™×™× */
            background: var(--bg-event-lodging);
            color: var(--text-dark);
            padding: .3rem .6rem;
            border-radius: .75rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            font-size: .95rem;
            /* cursor: pointer; - ××™×Ÿ ××™× ×˜×¨××§×¦×™×” ×‘×“×£ ×–×” */
            transition: transform .2s;
        }
        /* .lodging-badge:hover { transform: translateY(-1px); } */

        .event-row {
            display: flex; align-items: stretch;
            animation: popIn .3s ease-out both;
            /* cursor: pointer; - ××™×Ÿ ××™× ×˜×¨××§×¦×™×” ×¢×œ ×©×•×¨×” ×‘×“×£ ×–×” */
        }
        .times-col {
            width: 5.5rem;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            margin-left: 1rem; /* RTL: margin-right */
            color: var(--text-dark);
            font-weight: 500;
        }
        .content-col {
            position: relative; flex: 1;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            background: var(--bg-event-general);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: .75rem;
            /* transition: transform .2s, box-shadow .2s; - ××™×Ÿ ×”×•×‘×¨ ××™×•×—×“ */
            overflow: hidden; color: var(--text-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        /* .content-col:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        } */
        .content-col[data-type="×˜×™×¡×”"] { background: var(--bg-event-flight); }
        .content-col[data-type="×¦'×§-××™×Ÿ"],
        .content-col[data-type="×¦'×§-×××•×˜"] { background: var(--bg-event-lodging); }
        .content-col[data-type="××˜×¨×§×¦×™×”"],
        .content-col[data-type="×¡×™×•×¨"] { background: var(--bg-event-activity); }

        .content-col::before {
            content: attr(data-bg-emoji);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(5rem, 12vh, 7rem);
            line-height: 1;
            color: var(--text-dark);
            opacity: 0.08;
            z-index: 0;
            pointer-events: none;
        }
        .event-content-wrapper {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
        }
        .event-text-details {
            flex-grow: 1;
        }
        .event-icon {
            font-size: 1.5rem;
            margin-right: 10px; /* ×©×•× ×” ×-margin-left ×‘×’×œ×œ RTL */
        }
        .content-col[data-type="×˜×™×¡×”"] .event-icon-flight {
            position: absolute;
            left: 15px; /* ×™×™×©××¨ ×‘×¦×“ ×©×××œ ×›×™ ×–×” ××™×™×§×•×Ÿ ×©×œ ××˜×•×¡ ×©××¦×‘×™×¢ ×œ×›×™×•×•×Ÿ ××¡×•×™× */
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.8rem;
        }
        .event-divider {
            border: 0; border-top: 1px solid #eee;
            margin: 1rem 0;
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
        .btn-navigate {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: background-color 0.2s;
            padding: 0;
            position: absolute;
            bottom: 8px;
            right: 10px; /* RTL */
            left: auto;
        }
        .btn-navigate:hover {
            background-color: #ff701a;
        }
        /* --- ×¡×•×£ ×¡×’× ×•× ×•×ª ×©×”×•×¢×ª×§×• --- */

        #noScheduleMessage {
            text-align: center;
            font-size: 1.2em;
            padding: 2rem;
            background-color: var(--secondary);
            border-radius: .5rem;
        }

    </style>
</head>
<body>
    <a class="navbar-brand-live" href="#">×–××Ÿ ×–×”×‘ - ×—×•×¤×©×” ğŸ˜Š</a>

    <div class="container py-4">
        <h2 id="displayScheduleName" class="text-center mb-4 schedule-title">×˜×•×¢×Ÿ ×œ×•"×–...</h2>
        <div id="scheduleContainer">
            </div>
        <div id="noScheduleMessage" style="display: none;">
            <p>×œ× × ××¦× ××™×“×¢ ×¢×‘×•×¨ ×œ×•"×– ×–×”, ××• ×©×”××™×“×¢ ××™× ×• ×‘×¤×•×¨××˜ ×”× ×“×¨×©.</p>
            <p><a href="my-schedules.html">×—×–×•×¨ ×œ×œ×•"×–×™× ×©×œ×™</a></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const weekdayNames = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];
        const emojiMap = {
            '×”×©×§××”': 'â°', '×©×™× ×”': 'ğŸ›ï¸', '×”×œ×™×›×”/× ×¡×™×¢×”': 'ğŸš¶â€â™‚ï¸',
            '×¨×›×‘': 'ğŸš—', '×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª': 'ğŸšŒ', '×”×œ×™×›×”': 'ğŸš¶â€â™‚ï¸',
            '××•×›×œ': 'ğŸ´', '×¡×™×•×¨': 'ğŸï¸', '××˜×¨×§×¦×™×”': 'ğŸŸï¸',
            '×˜×™×¡×”': 'âœˆï¸', '×¦\'×§-××™×Ÿ': 'ğŸ§³', '×¦\'×§-×××•×˜': 'ğŸ‘‹'
            // × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×¢×•×“ ××™×¤×•×™×™× ×× ×™×© ×¦×•×¨×š ×× ×•×©××™× ××•×ª×××™× ××™×©×™×ª
        };

        document.addEventListener('DOMContentLoaded', () => {
            const storedData = localStorage.getItem('liveVacationScheduleData');
            // localStorage.removeItem('liveVacationScheduleData'); // × ×§×” ××—×¨×™ ×©×™××•×©

            const scheduleNameEl = document.getElementById('displayScheduleName');
            const scheduleContainerEl = document.getElementById('scheduleContainer');
            const noScheduleMessageEl = document.getElementById('noScheduleMessage');

            if (!storedData) {
                scheduleNameEl.textContent = '×©×’×™××”';
                noScheduleMessageEl.style.display = 'block';
                console.error('No schedule data found in localStorage.');
                return;
            }

            try {
                const liveVacationData = JSON.parse(storedData);

                if (!liveVacationData || !liveVacationData.name || !liveVacationData.scheduleEvents || !liveVacationData.lodgings) {
                    scheduleNameEl.textContent = '×©×’×™××” ×‘×¤×•×¨××˜ ×”× ×ª×•× ×™×';
                    noScheduleMessageEl.style.display = 'block';
                    console.error('Schedule data is missing required fields (name, scheduleEvents, lodgings).', liveVacationData);
                    return;
                }

                scheduleNameEl.textContent = `×œ×•×–: ${liveVacationData.name}`;
                renderFullSchedule(liveVacationData.scheduleEvents, liveVacationData.lodgings, scheduleContainerEl);

            } catch (error) {
                scheduleNameEl.textContent = '×©×’×™××” ×‘×¢×™×‘×•×“ ×”× ×ª×•× ×™×';
                noScheduleMessageEl.style.display = 'block';
                console.error('Error parsing or rendering schedule data:', error);
            }
        });

        function renderFullSchedule(scheduleEvents, lodgings, container) {
            container.innerHTML = ''; // × ×§×” ×ª×•×›×Ÿ ×§×•×“×
            if (Object.keys(scheduleEvents).length === 0) {
                 container.innerHTML = '<p class="text-center p-3">×”×œ×•"×– ×”×–×” ×¨×™×§ ×××™×¨×•×¢×™×.</p>';
                 return;
            }

            const sortedDates = Object.keys(scheduleEvents).sort((a, b) => new Date(a) - new Date(b));

            sortedDates.forEach(dateString => {
                const dayName = weekdayNames[new Date(dateString).getDay()];
                const dayBlockElement = createDayBlock(dayName, dateString, lodgings); // ×¤×•× ×§×¦×™×” ××•×¢×ª×§×ª/××•×ª×××ª
                container.appendChild(dayBlockElement);

                const eventsForDate = scheduleEvents[dateString] || [];
                eventsForDate.sort((a,b) => (a.start || a.departTime || '').localeCompare(b.start || b.departTime || ''));

                eventsForDate.forEach((eventData, index) => {
                    if (index > 0 && eventsForDate.length > 1) {
                        let hr = document.createElement('hr');
                        hr.className = 'event-divider';
                        dayBlockElement.appendChild(hr);
                    }
                    renderEventRow(dayBlockElement, dateString, eventData); // ×¤×•× ×§×¦×™×” ××•×¢×ª×§×ª/××•×ª×××ª
                });
            });
        }

        // --- ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×©×”×•×¢×ª×§×•/×”×•×ª×××• ×-×—×•×¤×©×”.html ---
        // (×—×œ×§×Ÿ ×¤×•×©×˜×• ×›×™ ××™×Ÿ ××™× ×˜×¨××§×¦×™×•×ª ×¢×¨×™×›×”/××—×™×§×” ×‘×“×£ ×–×”)

        function createDayBlock(day, date, lodgingsArray) {
            let blk = document.createElement('div');
            blk.className = 'day-block';
            blk.dataset.date = date;
            
            // ×™×¦×™×¨×ª ×ª×’×™×•×ª ×œ×™× ×” ×¢×‘×•×¨ ×”×›×•×ª×¨×ª ×”×™×•××™×ª
            let badgesHTML = '';
            if (lodgingsArray && Array.isArray(lodgingsArray)) {
                badgesHTML = lodgingsArray
                    .filter(l => date >= l.checkInDate && date <= l.checkOutDate)
                    .map(l => `<span class="lodging-badge" data-lodging-id="${l.id}">${l.name}</span>`) // ×œ×œ× onclick
                    .join('');
            }
            
            blk.innerHTML = `<div class="day-header"><span>${day} â€“ ${new Date(date).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'numeric'})}</span>${badgesHTML}</div>`;
            return blk;
        }

        function renderEventRow(dayBlockElement, date, eventData) {
            // ××™×Ÿ ×¦×•×¨×š ×œ×‘×“×•×§ ×× ×”×‘×œ×•×§ ×§×™×™×, ×›×™ ×× ×—× ×• ×™×•×¦×¨×™× ××•×ª×• ×•××¢×‘×™×¨×™× ××•×ª×•
            // ××™×Ÿ ×¦×•×¨×š ×œ×”×¡×™×¨ ×©×•×¨×” ×§×™×™××ª, ×›×™ ×× ×—× ×• ×‘×•× ×™× ××—×“×© ×›×œ ×¤×¢×
            
            let rowDiv = document.createElement('div');
            rowDiv.className = 'event-row';
            // rowDiv.id = eventData.id; // ×”-ID ×”××§×•×¨×™ ×¢×“×™×™×Ÿ ×©×™××•×©×™ ×× × ×¨×¦×” ×œ×”×•×¡×™×£ ××™× ×˜×¨××§×¦×™×•×ª ×‘×¢×ª×™×“
            // ××™×Ÿ onclick ×¢×œ ×”×©×•×¨×” ×‘×“×£ ×–×”

            let times = document.createElement('div');
            times.className = 'times-col';
            const start = eventData.start || eventData.departTime;
            const end = eventData.end || eventData.arriveTime;
            times.innerHTML = `<span>${start || ''}</span><span>${end || ''}</span>`;

            let content = document.createElement('div');
            content.className = 'content-col';
            content.setAttribute('data-type', eventData.type);

            let bgKey = eventData.type;
            if (eventData.type === '×”×œ×™×›×”/× ×¡×™×¢×”' && eventData.mode) {
                if (eventData.mode.includes('×¨×›×‘')) bgKey = '×¨×›×‘';
                else if (eventData.mode.includes('×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª')) bgKey = '×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª';
                else if (eventData.mode.includes('×”×œ×™×›×”')) bgKey = '×”×œ×™×›×”';
            }
            const bgEmoji = emojiMap[bgKey] || emojiMap[eventData.type] || '';
            if (bgEmoji) content.setAttribute('data-bg-emoji', bgEmoji);
            else content.removeAttribute('data-bg-emoji');

            let eventHTML = '', iconHTML = '';
            const generalEmoji = emojiMap[eventData.type] || 'ğŸ“';

            switch(eventData.type) {
                case '×˜×™×¡×”':
                    iconHTML = `<div class="event-icon-flight">âœˆï¸</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>×˜×™×¡×” ×${eventData.from || ''} â¬…ï¸ ${eventData.to || ''}</strong></div>
                            <div>${eventData.number || ''}${eventData.airline ? ` / ${eventData.airline}` : ''}</div>
                            <div>×”××¨××” ğŸ›«: ${eventData.departTime || ''}</div>
                            <div>× ×—×™×ª×” ğŸ›¬: ${eventData.arriveTime || ''}</div>
                            ${eventData.description ? `<div><em>${eventData.description}</em></div>` : ''}
                        </div>`;
                    if (eventData.from) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.from.replace(/'/g, "\\'")}')" title="× ×•×•×˜ ××œ ${eventData.from}">ğŸ—ºï¸</button>`;
                    }
                    break;
                case '×”×©×§××”': case '×©×™× ×”':
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.type}</strong></div>
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    break;
                case '×”×œ×™×›×”/× ×¡×™×¢×”':
                    let displayEmoji = emojiMap['×”×œ×™×›×”/× ×¡×™×¢×”'];
                    if (eventData.mode) {
                        if (eventData.mode.includes('×¨×›×‘')) displayEmoji = emojiMap['×¨×›×‘'] || 'ğŸš—';
                        else if (eventData.mode.includes('×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª')) displayEmoji = emojiMap['×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª'] || 'ğŸšŒ';
                        else if (eventData.mode.includes('×”×œ×™×›×”')) displayEmoji = emojiMap['×”×œ×™×›×”'] || 'ğŸš¶â€â™‚ï¸';
                    }
                    iconHTML = `<div class="event-icon">${displayEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.mode || '×”×œ×™×›×”/× ×¡×™×¢×”'}</strong></div>
                            ${eventData.startLocation ? `<div>×: ${eventData.startLocation}</div>` : ''}
                            <div>××œ: ${eventData.endLocation || ''}</div>
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    if (eventData.endLocation) {
                         eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.endLocation.replace(/'/g, "\\'")}')" title="× ×•×•×˜ ××œ ${eventData.endLocation}">ğŸ—ºï¸</button>`;
                    }
                    break;
                case "×¦'×§-××™×Ÿ": case "×¦'×§-×××•×˜":
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.type}: ${eventData.lodgingName || ''}</strong></div>
                            ${eventData.location ? `<div>${eventData.location}</div>` : ''}
                        </div>`;
                    if (eventData.type === "×¦'×§-××™×Ÿ" && eventData.location) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.location.replace(/'/g, "\\'")}')" title="× ×•×•×˜ ××œ ${eventData.location}">ğŸ—ºï¸</button>`;
                    }
                    break;
                default: // ××™×¨×•×¢×™× ×›×œ×œ×™×™× (×›×•×œ×œ × ×•×©××™× ××•×ª×××™× ××™×©×™×ª)
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    let title = eventData.customSubjectName || eventData.type;
                    if (eventData.type === '××•×›×œ' && eventData.foodPlace) title = `${eventData.foodPlace}`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${title}</strong></div>
                            ${eventData.location ? `<div>××™×§×•×: ${eventData.location}</div>` : ''}
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    if (eventData.location) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.location.replace(/'/g, "\\'")}')" title="× ×•×•×˜ ××œ ${eventData.location}">ğŸ—ºï¸</button>`;
                    }
            }
            content.innerHTML = `<div class="event-content-wrapper">${iconHTML}${eventHTML}</div>`;
            rowDiv.append(times, content);
            dayBlockElement.appendChild(rowDiv);
            // ××™×Ÿ ×¦×•×¨×š ×‘-sortDayEvents ×›××Ÿ ×›×™ ×”××™×¨×•×¢×™× ×›×‘×¨ ×××•×™× ×™× ×œ×¤× ×™ ×”×§×¨×™××” ×œ-renderEventRow
        }
        
        function openMapForNavigation(addr) {
            if (addr) window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}`, '_blank');
        }

    </script>
</body>
</html>