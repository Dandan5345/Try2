<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>זמן זהב - לו"ז חופשה</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #ff8c42;
            --secondary: #fff0e6;
            --holiday-bg: #ffe4c4; /* רקע חופשה כמו בדף יצירה */
            --bg-event-general: #ffffff;
            --bg-event-lodging: #e6f7ff;
            --bg-event-flight: #cce0ff;
            --bg-event-activity: #fff9e6;
            --text-dark: #5a4f45;
            --text-light: #ffffff;
            --day-block-bg: #ffffff;
            --day-block-shadow: rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Rubik', sans-serif;
            background: var(--holiday-bg);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            padding-top: 20px; /* ריווח עליון */
            padding-bottom: 20px; /* ריווח תחתון */
        }
        .navbar-brand-live {
            font-size: 1.8rem; /* גודל מותאם */
            font-weight: 700;
            color: var(--primary) !important;
            text-decoration: none;
            display: block; /* כדי שה-text-align יפעל */
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .schedule-title {
            color: var(--text-dark);
            font-weight: 700;
            font-size: 1.8em; /* גודל כותרת לוז */
        }
        .container {
            background-color: rgba(255, 255, 255, 0.8); /* רקע מעט שקוף לקונטיינר */
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* --- סגנונות שהועתקו מדף חופשה.html --- */
        .day-block {
            background: var(--day-block-bg);
            color: var(--text-dark);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--day-block-shadow);
            transition: background .3s;
        }
        .day-block:hover { background: #fefefe; }
        .day-block[data-date] { position: relative; }
        .day-header {
            display: flex; flex-wrap: wrap;
            justify-content: center; align-items: center;
            gap: .5rem; font-size: 1.3rem; font-weight: 500;
            letter-spacing: .5px; margin-bottom: 1.5rem;
            color: var(--primary);
        }
        .lodging-badge { /* יוצג אם המידע קיים */
            background: var(--bg-event-lodging);
            color: var(--text-dark);
            padding: .3rem .6rem;
            border-radius: .75rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            font-size: .95rem;
            /* cursor: pointer; - אין אינטראקציה בדף זה */
            transition: transform .2s;
        }
        /* .lodging-badge:hover { transform: translateY(-1px); } */

        .event-row {
            display: flex; align-items: stretch;
            animation: popIn .3s ease-out both;
            /* cursor: pointer; - אין אינטראקציה על שורה בדף זה */
        }
        .times-col {
            width: 5.5rem;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            margin-left: 1rem; /* RTL: margin-right */
            color: var(--text-dark);
            font-weight: 500;
        }
        .content-col {
            position: relative; flex: 1;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            background: var(--bg-event-general);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: .75rem;
            /* transition: transform .2s, box-shadow .2s; - אין הובר מיוחד */
            overflow: hidden; color: var(--text-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        /* .content-col:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        } */
        .content-col[data-type="טיסה"] { background: var(--bg-event-flight); }
        .content-col[data-type="צ'ק-אין"],
        .content-col[data-type="צ'ק-אאוט"] { background: var(--bg-event-lodging); }
        .content-col[data-type="אטרקציה"],
        .content-col[data-type="סיור"] { background: var(--bg-event-activity); }

        .content-col::before {
            content: attr(data-bg-emoji);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(5rem, 12vh, 7rem);
            line-height: 1;
            color: var(--text-dark);
            opacity: 0.08;
            z-index: 0;
            pointer-events: none;
        }
        .event-content-wrapper {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
        }
        .event-text-details {
            flex-grow: 1;
        }
        .event-icon {
            font-size: 1.5rem;
            margin-right: 10px; /* שונה מ-margin-left בגלל RTL */
        }
        .content-col[data-type="טיסה"] .event-icon-flight {
            position: absolute;
            left: 15px; /* יישאר בצד שמאל כי זה אייקון של מטוס שמצביע לכיוון מסוים */
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.8rem;
        }
        .event-divider {
            border: 0; border-top: 1px solid #eee;
            margin: 1rem 0;
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
        .btn-navigate {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: background-color 0.2s;
            padding: 0;
            position: absolute;
            bottom: 8px;
            right: 10px; /* RTL */
            left: auto;
        }
        .btn-navigate:hover {
            background-color: #ff701a;
        }
        /* --- סוף סגנונות שהועתקו --- */

        #noScheduleMessage {
            text-align: center;
            font-size: 1.2em;
            padding: 2rem;
            background-color: var(--secondary);
            border-radius: .5rem;
        }

    </style>
</head>
<body>
    <a class="navbar-brand-live" href="#">זמן זהב - חופשה 😊</a>

    <div class="container py-4">
        <h2 id="displayScheduleName" class="text-center mb-4 schedule-title">טוען לו"ז...</h2>
        <div id="scheduleContainer">
            </div>
        <div id="noScheduleMessage" style="display: none;">
            <p>לא נמצא מידע עבור לו"ז זה, או שהמידע אינו בפורמט הנדרש.</p>
            <p><a href="my-schedules.html">חזור ללו"זים שלי</a></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const weekdayNames = ['ראשון', 'שני', 'שלישי', 'רביעי', 'חמישי', 'שישי', 'שבת'];
        const emojiMap = {
            'השקמה': '⏰', 'שינה': '🛏️', 'הליכה/נסיעה': '🚶‍♂️',
            'רכב': '🚗', 'תחבורה ציבורית': '🚌', 'הליכה': '🚶‍♂️',
            'אוכל': '🍴', 'סיור': '🏞️', 'אטרקציה': '🎟️',
            'טיסה': '✈️', 'צ\'ק-אין': '🧳', 'צ\'ק-אאוט': '👋'
            // ניתן להוסיף עוד מיפויים אם יש צורך מנושאים מותאמים אישית
        };

        document.addEventListener('DOMContentLoaded', () => {
            const storedData = localStorage.getItem('liveVacationScheduleData');
            // localStorage.removeItem('liveVacationScheduleData'); // נקה אחרי שימוש

            const scheduleNameEl = document.getElementById('displayScheduleName');
            const scheduleContainerEl = document.getElementById('scheduleContainer');
            const noScheduleMessageEl = document.getElementById('noScheduleMessage');

            if (!storedData) {
                scheduleNameEl.textContent = 'שגיאה';
                noScheduleMessageEl.style.display = 'block';
                console.error('No schedule data found in localStorage.');
                return;
            }

            try {
                const liveVacationData = JSON.parse(storedData);

                if (!liveVacationData || !liveVacationData.name || !liveVacationData.scheduleEvents || !liveVacationData.lodgings) {
                    scheduleNameEl.textContent = 'שגיאה בפורמט הנתונים';
                    noScheduleMessageEl.style.display = 'block';
                    console.error('Schedule data is missing required fields (name, scheduleEvents, lodgings).', liveVacationData);
                    return;
                }

                scheduleNameEl.textContent = `לוז: ${liveVacationData.name}`;
                renderFullSchedule(liveVacationData.scheduleEvents, liveVacationData.lodgings, scheduleContainerEl);

            } catch (error) {
                scheduleNameEl.textContent = 'שגיאה בעיבוד הנתונים';
                noScheduleMessageEl.style.display = 'block';
                console.error('Error parsing or rendering schedule data:', error);
            }
        });

        function renderFullSchedule(scheduleEvents, lodgings, container) {
            container.innerHTML = ''; // נקה תוכן קודם
            if (Object.keys(scheduleEvents).length === 0) {
                 container.innerHTML = '<p class="text-center p-3">הלו"ז הזה ריק מאירועים.</p>';
                 return;
            }

            const sortedDates = Object.keys(scheduleEvents).sort((a, b) => new Date(a) - new Date(b));

            sortedDates.forEach(dateString => {
                const dayName = weekdayNames[new Date(dateString).getDay()];
                const dayBlockElement = createDayBlock(dayName, dateString, lodgings); // פונקציה מועתקת/מותאמת
                container.appendChild(dayBlockElement);

                const eventsForDate = scheduleEvents[dateString] || [];
                eventsForDate.sort((a,b) => (a.start || a.departTime || '').localeCompare(b.start || b.departTime || ''));

                eventsForDate.forEach((eventData, index) => {
                    if (index > 0 && eventsForDate.length > 1) {
                        let hr = document.createElement('hr');
                        hr.className = 'event-divider';
                        dayBlockElement.appendChild(hr);
                    }
                    renderEventRow(dayBlockElement, dateString, eventData); // פונקציה מועתקת/מותאמת
                });
            });
        }

        // --- פונקציות עזר שהועתקו/הותאמו מ-חופשה.html ---
        // (חלקן פושטו כי אין אינטראקציות עריכה/מחיקה בדף זה)

        function createDayBlock(day, date, lodgingsArray) {
            let blk = document.createElement('div');
            blk.className = 'day-block';
            blk.dataset.date = date;
            
            // יצירת תגיות לינה עבור הכותרת היומית
            let badgesHTML = '';
            if (lodgingsArray && Array.isArray(lodgingsArray)) {
                badgesHTML = lodgingsArray
                    .filter(l => date >= l.checkInDate && date <= l.checkOutDate)
                    .map(l => `<span class="lodging-badge" data-lodging-id="${l.id}">${l.name}</span>`) // ללא onclick
                    .join('');
            }
            
            blk.innerHTML = `<div class="day-header"><span>${day} – ${new Date(date).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'numeric'})}</span>${badgesHTML}</div>`;
            return blk;
        }

        function renderEventRow(dayBlockElement, date, eventData) {
            // אין צורך לבדוק אם הבלוק קיים, כי אנחנו יוצרים אותו ומעבירים אותו
            // אין צורך להסיר שורה קיימת, כי אנחנו בונים מחדש כל פעם
            
            let rowDiv = document.createElement('div');
            rowDiv.className = 'event-row';
            // rowDiv.id = eventData.id; // ה-ID המקורי עדיין שימושי אם נרצה להוסיף אינטראקציות בעתיד
            // אין onclick על השורה בדף זה

            let times = document.createElement('div');
            times.className = 'times-col';
            const start = eventData.start || eventData.departTime;
            const end = eventData.end || eventData.arriveTime;
            times.innerHTML = `<span>${start || ''}</span><span>${end || ''}</span>`;

            let content = document.createElement('div');
            content.className = 'content-col';
            content.setAttribute('data-type', eventData.type);

            let bgKey = eventData.type;
            if (eventData.type === 'הליכה/נסיעה' && eventData.mode) {
                if (eventData.mode.includes('רכב')) bgKey = 'רכב';
                else if (eventData.mode.includes('תחבורה ציבורית')) bgKey = 'תחבורה ציבורית';
                else if (eventData.mode.includes('הליכה')) bgKey = 'הליכה';
            }
            const bgEmoji = emojiMap[bgKey] || emojiMap[eventData.type] || '';
            if (bgEmoji) content.setAttribute('data-bg-emoji', bgEmoji);
            else content.removeAttribute('data-bg-emoji');

            let eventHTML = '', iconHTML = '';
            const generalEmoji = emojiMap[eventData.type] || '📝';

            switch(eventData.type) {
                case 'טיסה':
                    iconHTML = `<div class="event-icon-flight">✈️</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>טיסה מ${eventData.from || ''} ⬅️ ${eventData.to || ''}</strong></div>
                            <div>${eventData.number || ''}${eventData.airline ? ` / ${eventData.airline}` : ''}</div>
                            <div>המראה 🛫: ${eventData.departTime || ''}</div>
                            <div>נחיתה 🛬: ${eventData.arriveTime || ''}</div>
                            ${eventData.description ? `<div><em>${eventData.description}</em></div>` : ''}
                        </div>`;
                    if (eventData.from) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.from.replace(/'/g, "\\'")}')" title="נווט אל ${eventData.from}">🗺️</button>`;
                    }
                    break;
                case 'השקמה': case 'שינה':
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.type}</strong></div>
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    break;
                case 'הליכה/נסיעה':
                    let displayEmoji = emojiMap['הליכה/נסיעה'];
                    if (eventData.mode) {
                        if (eventData.mode.includes('רכב')) displayEmoji = emojiMap['רכב'] || '🚗';
                        else if (eventData.mode.includes('תחבורה ציבורית')) displayEmoji = emojiMap['תחבורה ציבורית'] || '🚌';
                        else if (eventData.mode.includes('הליכה')) displayEmoji = emojiMap['הליכה'] || '🚶‍♂️';
                    }
                    iconHTML = `<div class="event-icon">${displayEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.mode || 'הליכה/נסיעה'}</strong></div>
                            ${eventData.startLocation ? `<div>מ: ${eventData.startLocation}</div>` : ''}
                            <div>אל: ${eventData.endLocation || ''}</div>
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    if (eventData.endLocation) {
                         eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.endLocation.replace(/'/g, "\\'")}')" title="נווט אל ${eventData.endLocation}">🗺️</button>`;
                    }
                    break;
                case "צ'ק-אין": case "צ'ק-אאוט":
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${eventData.type}: ${eventData.lodgingName || ''}</strong></div>
                            ${eventData.location ? `<div>${eventData.location}</div>` : ''}
                        </div>`;
                    if (eventData.type === "צ'ק-אין" && eventData.location) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.location.replace(/'/g, "\\'")}')" title="נווט אל ${eventData.location}">🗺️</button>`;
                    }
                    break;
                default: // אירועים כלליים (כולל נושאים מותאמים אישית)
                    iconHTML = `<div class="event-icon">${generalEmoji}</div>`;
                    let title = eventData.customSubjectName || eventData.type;
                    if (eventData.type === 'אוכל' && eventData.foodPlace) title = `${eventData.foodPlace}`;
                    eventHTML = `
                        <div class="event-text-details">
                            <div><strong>${title}</strong></div>
                            ${eventData.location ? `<div>מיקום: ${eventData.location}</div>` : ''}
                            ${eventData.description ? `<div>${eventData.description}</div>` : ''}
                        </div>`;
                    if (eventData.location) {
                        eventHTML += `<button class="btn-navigate" onclick="openMapForNavigation('${eventData.location.replace(/'/g, "\\'")}')" title="נווט אל ${eventData.location}">🗺️</button>`;
                    }
            }
            content.innerHTML = `<div class="event-content-wrapper">${iconHTML}${eventHTML}</div>`;
            rowDiv.append(times, content);
            dayBlockElement.appendChild(rowDiv);
            // אין צורך ב-sortDayEvents כאן כי האירועים כבר ממוינים לפני הקריאה ל-renderEventRow
        }
        
        function openMapForNavigation(addr) {
            if (addr) window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}`, '_blank');
        }

    </script>
</body>
</html>